# promptrek install-hooks

Install PrompTrek pre-commit hooks to prevent committing generated files.

## Synopsis

```bash
promptrek install-hooks [OPTIONS]
```

## Description

The `install-hooks` command safely integrates PrompTrek hooks into your project's `.pre-commit-config.yaml`. These hooks prevent common mistakes like committing generated editor files or local secrets.

**Installed hooks**:

1. **promptrek-validate**: Validates `.promptrek.yaml` files before commit
2. **promptrek-prevent-generated**: Prevents committing generated editor files
3. **promptrek-check-local-vars**: Prevents committing local variables (secrets)

## Options

**`--config FILE`**
: Path to `.pre-commit-config.yaml` (default: `.pre-commit-config.yaml`)

**`--force`**
: Overwrite existing hooks without confirmation

**`--activate`**
: Run `pre-commit install` to activate hooks in git

## Pre-requisites

Install `pre-commit` first:

```bash
# Using pip
pip install pre-commit

# Using uv (recommended for PrompTrek development)
uv pip install pre-commit

# Using homebrew (macOS)
brew install pre-commit
```

## Examples

### Basic Installation

Install hooks with default settings:

```bash
promptrek install-hooks
```

Output:
```
‚úÖ Added PrompTrek hooks to .pre-commit-config.yaml

üìù Next steps:
1. Install pre-commit: pip install pre-commit
2. Install hooks: pre-commit install
3. (Optional) Run on all files: pre-commit run --all-files
```

### Install and Activate

Install hooks and activate them immediately:

```bash
promptrek install-hooks --activate
```

Output:
```
‚úÖ Added PrompTrek hooks to .pre-commit-config.yaml

üîß Running pre-commit install...
‚úÖ Git hooks activated successfully!

üí° Hooks will now run automatically on git commit
   Run manually: pre-commit run --all-files
```

### Force Update

Update existing hooks:

```bash
promptrek install-hooks --force
```

### Custom Config File

Use non-standard config file location:

```bash
promptrek install-hooks --config .github/pre-commit-config.yaml
```

## Installed Hooks

### 1. promptrek-validate

Validates PrompTrek files on commit:

```yaml
- id: promptrek-validate
  name: Validate PrompTrek files
  entry: promptrek validate
  language: system
  files: \.promptrek\.ya?ml$
  pass_filenames: true
  stages: [pre-commit]
```

**What it does**:
- Validates syntax and structure
- Checks required fields
- Verifies schema version
- Validates plugin configurations

**Example**:
```bash
$ git commit -m "Update config"

Validate PrompTrek files...................Failed
- hook id: promptrek-validate
- exit code: 1

‚ùå Validation failed: metadata.title is required
```

### 2. promptrek-prevent-generated

Prevents committing generated files:

```yaml
- id: promptrek-prevent-generated
  name: Prevent committing generated files
  entry: promptrek check-generated
  language: system
  files: |
    (?x)(
    ^\.github/(copilot-instructions\.md|instructions/.*|prompts/.*)$|
    ^(\.cursorrules|\.cursor/.*|AGENTS\.md)$|
    ^\.continue/.*$|
    ^\.claude/.*$|
    ^\.cline.*$|
    ^\.windsurf/.*$|
    ^\.kiro/.*$|
    ^\.amazonq/.*$|
    ^\.assistant/.*
    )
  stages: [pre-commit]
  pass_filenames: true
```

**What it does**:
- Detects generated editor files
- Prevents accidental commits
- Shows helpful error messages

**Example**:
```bash
$ git add .claude/prompts/project.md
$ git commit -m "Add prompts"

Prevent committing generated files.........Failed
- hook id: promptrek-prevent-generated
- exit code: 1

‚ùå ERROR: Attempting to commit generated prompt files!

The following files appear to be generated by promptrek
and should not be committed:
  - .claude/prompts/project.md

üí° These files are generated from .promptrek.yaml files and should be:
   ‚Ä¢ Added to .gitignore
   ‚Ä¢ Generated locally as needed
   ‚Ä¢ Not committed to version control

To fix this:
1. Remove these files from staging: git reset HEAD <file>
2. Add them to .gitignore if not already there
3. Commit only your .promptrek.yaml source files
```

### 3. promptrek-check-local-vars

Prevents committing local variables file:

```yaml
- id: promptrek-check-local-vars
  name: Prevent committing local variables
  entry: promptrek check-generated
  language: system
  files: (^variables\.promptrek\.ya?ml$|\.promptrek/variables\.promptrek\.ya?ml$)
  stages: [pre-commit]
  pass_filenames: true
```

**What it does**:
- Detects local variables files
- Prevents leaking secrets
- Protects user-specific configuration

**Example**:
```bash
$ git add .promptrek/variables.promptrek.yaml
$ git commit -m "Add config"

Prevent committing local variables.........Failed
- hook id: promptrek-check-local-vars
- exit code: 1

‚ùå ERROR: Attempting to commit local variables file!

The following file contains user-specific variables
and should not be committed:
  - .promptrek/variables.promptrek.yaml

üí° This file should be:
   ‚Ä¢ Located in .promptrek/ directory (new location)
   ‚Ä¢ Added to .gitignore (should already be there)
   ‚Ä¢ Kept local to your machine
   ‚Ä¢ Not shared in version control
```

## Complete Workflow

### Initial Setup

```bash
# 1. Initialize PrompTrek
promptrek init

# 2. Install and activate hooks
promptrek install-hooks --activate

# 3. Configure .gitignore
promptrek config-ignores

# 4. Test hooks
pre-commit run --all-files

# 5. Commit configuration
git add .pre-commit-config.yaml project.promptrek.yaml .gitignore
git commit -m "feat: add PrompTrek with pre-commit hooks"
```

### Testing Hooks

```bash
# Run all hooks manually
pre-commit run --all-files

# Run specific hook
pre-commit run promptrek-validate --all-files

# Run on specific files
pre-commit run --files project.promptrek.yaml
```

### Updating Hooks

```bash
# Update PrompTrek hooks
promptrek install-hooks --force

# Update all hooks to latest versions
pre-commit autoupdate
```

## Generated Configuration

PrompTrek adds this to `.pre-commit-config.yaml`:

```yaml
repos:
  - repo: local
    hooks:
      - id: promptrek-validate
        name: Validate PrompTrek files
        entry: promptrek validate
        language: system
        files: \.promptrek\.ya?ml$
        pass_filenames: true
        stages: [pre-commit]

      - id: promptrek-prevent-generated
        name: Prevent committing generated files
        entry: promptrek check-generated
        language: system
        files: (?x)(^\.github/(...)|^\.claude/...)
        stages: [pre-commit]
        pass_filenames: true

      - id: promptrek-check-local-vars
        name: Prevent committing local variables
        entry: promptrek check-generated
        language: system
        files: (^variables\.promptrek\.ya?ml$|\.promptrek/variables\.promptrek\.ya?ml$)
        stages: [pre-commit]
        pass_filenames: true
```

## Integration with Existing Hooks

### Merging with Existing Configuration

PrompTrek safely merges with existing `.pre-commit-config.yaml`:

```yaml
# Existing hooks
repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer

  # PrompTrek hooks added here
  - repo: local
    hooks:
      - id: promptrek-validate
        # ...
```

### Updating Existing PrompTrek Hooks

```bash
$ promptrek install-hooks

‚ö†Ô∏è  PrompTrek hooks already configured.
Do you want to update them? [y/N] y

‚úÖ Updated PrompTrek hooks to .pre-commit-config.yaml
```

## Bypassing Hooks

### Emergency Bypass

If you absolutely need to bypass hooks:

```bash
# Bypass all hooks (use with caution!)
git commit --no-verify -m "Emergency commit"

# Or set environment variable
SKIP=promptrek-validate git commit -m "Skip validation"
```

!!! warning "Use Sparingly"
    Only bypass hooks when absolutely necessary. Fix issues instead of bypassing.

## Troubleshooting

### pre-commit Not Found

**Problem**: `pre-commit` command not available

**Solution**: Install pre-commit

```bash
pip install pre-commit
# or
uv pip install pre-commit
```

### promptrek Command Not Found in Hook

**Problem**: Hook fails with `promptrek: command not found`

**Solution**: Ensure PrompTrek is installed globally or use `uv run`:

```bash
# For development (uses local version)
# Hooks automatically use "uv run promptrek" if pyproject.toml exists

# For users (global install)
pip install promptrek
# or
uv pip install promptrek
```

### Hooks Not Running

**Problem**: Hooks don't run on commit

**Solution**: Activate hooks

```bash
pre-commit install
```

### False Positives

**Problem**: Hook blocks valid commits

**Solution**: Verify files shouldn't be committed

```bash
# Check what hook detected
pre-commit run promptrek-prevent-generated --files <file>

# If file should be committed (rare), bypass specific hook
SKIP=promptrek-prevent-generated git commit -m "Commit message"
```

## Best Practices

!!! tip "Install Early"
    Set up hooks when initializing PrompTrek:
    ```bash
    promptrek init
    promptrek install-hooks --activate
    ```

!!! tip "Test Hooks Locally"
    Run hooks manually before committing:
    ```bash
    pre-commit run --all-files
    ```

!!! warning "Don't Bypass Regularly"
    If you're frequently bypassing hooks, fix the underlying issue instead.

!!! note "Team Setup"
    Ensure all team members have pre-commit installed:
    ```bash
    # Add to README
    pip install pre-commit
    pre-commit install
    ```

## See Also

- [config-ignores command](config-ignores.md)
- [validate command](validate.md)
- [Pre-commit Workflow](../../user-guide/workflows/pre-commit.md)
- [pre-commit.com](https://pre-commit.com/) - Pre-commit documentation
