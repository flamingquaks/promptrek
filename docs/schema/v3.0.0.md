# Schema v3.0.0 Reference

Complete reference for PrompTrek Universal Prompt Format (UPF) v3.0.0.

## Overview

**Version**: 3.0.0
**Status**: Stable, maintained
**JSON Schema**: [v3.0.0.json](/schema/v3.0.0.json)

v3.0.0 introduces top-level plugin fields, removing the nested `plugins` wrapper from v2.1.

## Key Changes from v2.1

**Major change**: Plugin fields moved to top level

```yaml
# v2.1 (old)
plugins:
  mcp_servers: [...]
  commands: [...]

# v3.0 (new)
mcp_servers: [...]      # Top-level
commands: [...]         # Top-level
```

## Top-Level Fields

### Required Fields

#### schema_version

**Type**: `string`
**Required**: Yes

Must be `"3.0.0"`.

```yaml
schema_version: "3.0.0"
```

#### metadata

**Type**: `PromptMetadata` object
**Required**: Yes

```yaml
metadata:
  title: "Project Name"              # Required
  description: "Description"         # Required
  version: "1.0.0"                   # Optional
  author: "Author"                   # Optional
  created: "2024-01-15"              # Optional
  updated: "2024-01-20"              # Optional
  tags: [tag1, tag2]                 # Optional
```

#### content

**Type**: `string` (markdown)
**Required**: Yes

```yaml
content: |
  # Project Guidelines
  ...
```

### Optional Fields

#### content_description

**Type**: `string`
**Default**: `null`

```yaml
content_description: "Main guidelines"
```

#### content_always_apply

**Type**: `boolean`
**Default**: `null` (treated as `true`)

```yaml
content_always_apply: true
```

#### variables

**Type**: `object`
**Default**: `null`

```yaml
variables:
  PROJECT_NAME: "MyApp"
  VERSION: "1.0.0"
```

#### documents

**Type**: `array` of `DocumentConfig`
**Default**: `null`

```yaml
documents:
  - name: "testing"
    content: "Testing guidelines..."
    description: "Test docs"
    file_globs: "**/*.test.ts"
    always_apply: false
```

#### mcp_servers

**Type**: `array` of `MCPServer`
**Default**: `null`

**NEW IN v3.0**: Top-level field (was `plugins.mcp_servers` in v2.1)

```yaml
mcp_servers:
  - name: github
    command: npx
    args: ["-y", "@modelcontextprotocol/server-github"]
    env:
      GITHUB_TOKEN: "{{{ GITHUB_TOKEN }}}"
    description: "GitHub integration"
    trust_metadata:
      trusted: true
```

#### commands

**Type**: `array` of `Command`
**Default**: `null`

**NEW IN v3.0**: Top-level field (was `plugins.commands` in v2.1)

```yaml
commands:
  - name: review
    description: "Code review"
    prompt: "Review code..."
    output_format: markdown
    requires_approval: false
```

#### agents

**Type**: `array` of `Agent`
**Default**: `null`

**NEW IN v3.0**: Top-level field (was `plugins.agents` in v2.1)

```yaml
agents:
  - name: test-gen
    description: "Test generator"
    system_prompt: "Generate comprehensive tests"
    tools: [file_read, file_write]
    trust_level: partial
    requires_approval: true
```

**Note**: In v3.0, agents use `system_prompt`. v3.1 uses `prompt` instead.

#### hooks

**Type**: `array` of `Hook`
**Default**: `null`

**NEW IN v3.0**: Top-level field (was `plugins.hooks` in v2.1)

```yaml
hooks:
  - name: pre-commit
    event: pre-commit
    command: "npm test"
    description: "Run tests"
    conditions:
      path: "**/*.ts"
    requires_reapproval: false
```

#### ignore_editor_files

**Type**: `boolean`
**Default**: `null` (treated as `true`)

```yaml
ignore_editor_files: true
```

## Type Definitions

### MCPServer

```yaml
name: string                        # Required
command: string                     # Required
args: array of strings              # Optional
env: object (string key-values)     # Optional
description: string                 # Optional
trust_metadata: TrustMetadata       # Optional
```

### Command

```yaml
name: string                        # Required
description: string                 # Required
prompt: string                      # Required
output_format: string               # Optional
requires_approval: boolean          # Optional (default: false)
system_message: string              # Optional (deprecated)
examples: array of strings          # Optional
trust_metadata: TrustMetadata       # Optional
```

### Agent

```yaml
name: string                        # Required
description: string                 # Required
system_prompt: string               # Required (v3.0)
tools: array of strings             # Optional
trust_level: string                 # Optional (default: "untrusted")
requires_approval: boolean          # Optional (default: true)
context: object                     # Optional
trust_metadata: TrustMetadata       # Optional
```

**Note**: v3.1 changes `system_prompt` to `prompt` and makes `description` optional.

### Hook

```yaml
name: string                        # Required
event: string                       # Required
command: string                     # Required
description: string                 # Optional
conditions: object                  # Optional
requires_reapproval: boolean        # Optional (default: true)
trust_metadata: TrustMetadata       # Optional
```

### DocumentConfig

```yaml
name: string                        # Required
content: string                     # Required
description: string                 # Optional
file_globs: string                  # Optional
always_apply: boolean               # Optional
```

### TrustMetadata

```yaml
trusted: boolean                    # Default: false
trust_level: string                 # Optional
requires_approval: boolean          # Default: true
source: string                      # Optional
verified_by: string                 # Optional
verified_date: string               # Optional
```

## Complete Example

```yaml
schema_version: "3.0.0"

metadata:
  title: "Full-Stack TypeScript App"
  description: "Complete v3.0.0 example"
  version: "2.0.0"
  author: "Dev Team"
  tags: [typescript, react, node]

content: |
  # Project Guidelines
  Development standards and practices...

variables:
  PROJECT_NAME: "MyApp"
  NODE_VERSION: "20"
  GITHUB_TOKEN: "{{{ GITHUB_TOKEN }}}"

documents:
  - name: "frontend"
    file_globs: "src/frontend/**/*.tsx"
    content: |
      # Frontend Guidelines
      React development standards...

  - name: "backend"
    file_globs: "src/backend/**/*.ts"
    content: |
      # Backend Guidelines
      Node.js API development...

# Top-level plugin fields (new in v3.0)
mcp_servers:
  - name: github
    command: npx
    args: ["-y", "@modelcontextprotocol/server-github"]
    env:
      GITHUB_TOKEN: "{{{ GITHUB_TOKEN }}}"
    description: "GitHub API integration"
    trust_metadata:
      trusted: true
      trust_level: full

commands:
  - name: review-code
    description: "Comprehensive code review"
    prompt: |
      Review the code for:
      - Code quality
      - Best practices
      - Security issues
    output_format: markdown
    requires_approval: false

agents:
  - name: test-generator
    description: "Automated test generation"
    system_prompt: "Generate comprehensive unit tests using Jest"
    tools: [file_read, file_write, run_tests]
    trust_level: partial
    requires_approval: true

hooks:
  - name: pre-commit
    event: pre-commit
    command: "npm run lint && npm test"
    description: "Lint and test before commit"
    requires_reapproval: false

ignore_editor_files: true
```

## Migration from v2.1

### Automatic Migration

```bash
promptrek migrate old-v2.1.yaml -o new-v3.0.yaml
```

### Manual Migration

1. Update schema version:
   ```yaml
   schema_version: "3.0.0"
   ```

2. Move plugin fields to top level:
   ```yaml
   # Before (v2.1)
   plugins:
     mcp_servers: [...]
     commands: [...]
     agents: [...]
     hooks: [...]

   # After (v3.0)
   mcp_servers: [...]
   commands: [...]
   agents: [...]
   hooks: [...]
   ```

3. Remove `plugins` wrapper completely

## Backward Compatibility

v3.0 tools support v2.1 files with deprecation warnings:

```
⚠️  DEPRECATION WARNING:
   Detected nested plugin structure (plugins.*)
   This is deprecated and will be removed in v4.0
   Run: promptrek migrate file.yaml
```

## See Also

- [Schema Versions Overview](../user-guide/configuration/schema-versions.md)
- [Schema v3.1.0 Reference](v3.1.0.md) - Latest version
- [Migration Guide](../user-guide/workflows/migration.md)
- [V3 Migration Guide](/docs/V3_MIGRATION_GUIDE.md)
