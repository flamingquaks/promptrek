{
  "$defs": {
    "Agent": {
      "description": "Autonomous agent configuration.",
      "properties": {
        "name": {
          "description": "Agent name/identifier",
          "title": "Name",
          "type": "string"
        },
        "description": {
          "description": "Agent description and purpose",
          "title": "Description",
          "type": "string"
        },
        "system_prompt": {
          "description": "System prompt for the agent",
          "title": "System Prompt",
          "type": "string"
        },
        "tools": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Available tools for the agent",
          "title": "Tools"
        },
        "trust_level": {
          "default": "untrusted",
          "description": "Trust level for agent actions",
          "title": "Trust Level",
          "type": "string"
        },
        "requires_approval": {
          "default": true,
          "description": "Whether agent actions require approval",
          "title": "Requires Approval",
          "type": "boolean"
        },
        "context": {
          "anyOf": [
            {
              "additionalProperties": true,
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Additional context for the agent",
          "title": "Context"
        },
        "trust_metadata": {
          "anyOf": [
            {
              "$ref": "#/$defs/TrustMetadata"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Trust and security metadata"
        }
      },
      "required": [
        "name",
        "description",
        "system_prompt"
      ],
      "title": "Agent",
      "type": "object"
    },
    "Command": {
      "description": "Slash command or workflow configuration for AI editors.\n\nSupports both simple commands (single prompt) and complex workflows\n(multi-step procedures with tool calls). Use multi_step=True for workflows.",
      "properties": {
        "name": {
          "description": "Command name (e.g., 'review-code')",
          "title": "Name",
          "type": "string"
        },
        "description": {
          "description": "Command description",
          "title": "Description",
          "type": "string"
        },
        "prompt": {
          "description": "Prompt template for the command",
          "title": "Prompt",
          "type": "string"
        },
        "output_format": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Expected output format (e.g., 'markdown', 'json')",
          "title": "Output Format"
        },
        "requires_approval": {
          "default": false,
          "description": "Whether command execution requires approval",
          "title": "Requires Approval",
          "type": "boolean"
        },
        "system_message": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "deprecated": true,
          "description": "DEPRECATED: This field is ignored and will be removed in v3.2.0. Include any behavioral instructions directly in the 'prompt' field instead.",
          "title": "System Message (Deprecated)"
        },
        "examples": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Example usage of the command",
          "title": "Examples"
        },
        "trust_metadata": {
          "anyOf": [
            {
              "$ref": "#/$defs/TrustMetadata"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Trust and security metadata"
        },
        "multi_step": {
          "default": false,
          "description": "Whether this is a multi-step workflow (vs simple command)",
          "title": "Multi Step",
          "type": "boolean"
        },
        "steps": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/WorkflowStep"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Structured workflow steps (optional)",
          "title": "Steps"
        },
        "tool_calls": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Tools/commands this workflow uses (e.g., ['gh', 'read_file'])",
          "title": "Tool Calls"
        }
      },
      "required": [
        "name",
        "description",
        "prompt"
      ],
      "title": "Command",
      "type": "object"
    },
    "DocumentConfig": {
      "description": "A single document for multi-file editors (v2 schema).",
      "properties": {
        "name": {
          "description": "Document name (used for filename)",
          "title": "Name",
          "type": "string"
        },
        "content": {
          "description": "Raw markdown content",
          "title": "Content",
          "type": "string"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Human-readable description (used by Cursor, etc.)",
          "title": "Description"
        },
        "file_globs": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "File patterns where this applies (e.g., '**/*.{ts,tsx}'). Used by Cursor, Copilot path-specific rules.",
          "title": "File Globs"
        },
        "always_apply": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Whether to always apply this rule (Cursor alwaysApply). If false with file_globs, auto-attaches to matching files.",
          "title": "Always Apply"
        }
      },
      "required": [
        "name",
        "content"
      ],
      "title": "DocumentConfig",
      "type": "object"
    },
    "Hook": {
      "description": "Event-driven automation hook configuration.",
      "properties": {
        "name": {
          "description": "Hook name/identifier",
          "title": "Name",
          "type": "string"
        },
        "event": {
          "description": "Event that triggers the hook (e.g., 'pre-commit', 'post-save', 'prompt-submit', 'agent-spawn')",
          "title": "Event",
          "type": "string"
        },
        "command": {
          "description": "Command to execute",
          "title": "Command",
          "type": "string"
        },
        "conditions": {
          "anyOf": [
            {
              "additionalProperties": true,
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Conditions for hook execution",
          "title": "Conditions"
        },
        "requires_reapproval": {
          "default": true,
          "description": "Whether hook requires reapproval after changes",
          "title": "Requires Reapproval",
          "type": "boolean"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Hook description",
          "title": "Description"
        },
        "trust_metadata": {
          "anyOf": [
            {
              "$ref": "#/$defs/TrustMetadata"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Trust and security metadata"
        }
      },
      "required": [
        "name",
        "event",
        "command"
      ],
      "title": "Hook",
      "type": "object"
    },
    "MCPServer": {
      "description": "Model Context Protocol (MCP) server configuration.",
      "properties": {
        "name": {
          "description": "Server name/identifier",
          "title": "Name",
          "type": "string"
        },
        "command": {
          "description": "Command to start the server",
          "title": "Command",
          "type": "string"
        },
        "args": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Command line arguments",
          "title": "Args"
        },
        "env": {
          "anyOf": [
            {
              "additionalProperties": {
                "type": "string"
              },
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Environment variables",
          "title": "Env"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Human-readable description",
          "title": "Description"
        },
        "trust_metadata": {
          "anyOf": [
            {
              "$ref": "#/$defs/TrustMetadata"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Trust and security metadata"
        }
      },
      "required": [
        "name",
        "command"
      ],
      "title": "MCPServer",
      "type": "object"
    },
    "PromptMetadata": {
      "description": "Metadata about the prompt file.",
      "properties": {
        "title": {
          "description": "Human-readable title",
          "title": "Title",
          "type": "string"
        },
        "description": {
          "description": "Brief description of purpose",
          "title": "Description",
          "type": "string"
        },
        "version": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Semantic version of this prompt",
          "title": "Version"
        },
        "author": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Author name or email",
          "title": "Author"
        },
        "created": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "ISO 8601 date (YYYY-MM-DD)",
          "title": "Created"
        },
        "updated": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "ISO 8601 date (YYYY-MM-DD)",
          "title": "Updated"
        },
        "tags": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional tags for categorization",
          "title": "Tags"
        }
      },
      "required": [
        "title",
        "description"
      ],
      "title": "PromptMetadata",
      "type": "object"
    },
    "TrustMetadata": {
      "description": "Security and trust metadata for plugins.",
      "properties": {
        "trusted": {
          "default": false,
          "description": "Whether this plugin/config is trusted",
          "title": "Trusted",
          "type": "boolean"
        },
        "trust_level": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Trust level: 'full', 'partial', 'untrusted'",
          "title": "Trust Level"
        },
        "requires_approval": {
          "default": true,
          "description": "Whether actions require explicit approval",
          "title": "Requires Approval",
          "type": "boolean"
        },
        "source": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Source of the plugin (e.g., 'official', 'community', 'local')",
          "title": "Source"
        },
        "verified_by": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Who verified this plugin",
          "title": "Verified By"
        },
        "verified_date": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "When this plugin was verified (ISO 8601)",
          "title": "Verified Date"
        }
      },
      "title": "TrustMetadata",
      "type": "object"
    },
    "WorkflowStep": {
      "description": "Single step in a multi-step workflow.",
      "properties": {
        "name": {
          "description": "Step name/identifier",
          "title": "Name",
          "type": "string"
        },
        "action": {
          "description": "Action to perform (e.g., 'read_file', 'execute_command')",
          "title": "Action",
          "type": "string"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Human-readable step description",
          "title": "Description"
        },
        "params": {
          "anyOf": [
            {
              "additionalProperties": true,
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Parameters for the action",
          "title": "Params"
        },
        "conditions": {
          "anyOf": [
            {
              "additionalProperties": true,
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Conditions for step execution",
          "title": "Conditions"
        }
      },
      "required": [
        "name",
        "action"
      ],
      "title": "WorkflowStep",
      "type": "object"
    }
  },
  "additionalProperties": false,
  "description": "JSON Schema for Universal Prompt Format version 3.1 - Adds multi-step workflow support (multi_step, tool_calls, steps fields in commands)",
  "properties": {
    "schema_version": {
      "description": "UPF schema version (3.x.x)",
      "title": "Schema Version",
      "type": "string"
    },
    "metadata": {
      "$ref": "#/$defs/PromptMetadata",
      "description": "Prompt metadata"
    },
    "content": {
      "description": "Main markdown content",
      "title": "Content",
      "type": "string"
    },
    "content_description": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "Description for main content (used in editor frontmatter)",
      "title": "Content Description"
    },
    "content_always_apply": {
      "anyOf": [
        {
          "type": "boolean"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "Whether main content always applies (default: True)",
      "title": "Content Always Apply"
    },
    "documents": {
      "anyOf": [
        {
          "items": {
            "$ref": "#/$defs/DocumentConfig"
          },
          "type": "array"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "Additional documents for multi-file editors",
      "title": "Documents"
    },
    "variables": {
      "anyOf": [
        {
          "additionalProperties": {
            "type": "string"
          },
          "type": "object"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "Template variables",
      "title": "Variables"
    },
    "mcp_servers": {
      "anyOf": [
        {
          "items": {
            "$ref": "#/$defs/MCPServer"
          },
          "type": "array"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "MCP server configurations (top-level in v3.0+)",
      "title": "Mcp Servers"
    },
    "commands": {
      "anyOf": [
        {
          "items": {
            "$ref": "#/$defs/Command"
          },
          "type": "array"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "Slash command configurations (top-level in v3.0+)",
      "title": "Commands"
    },
    "agents": {
      "anyOf": [
        {
          "items": {
            "$ref": "#/$defs/Agent"
          },
          "type": "array"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "Agent configurations (top-level in v3.0+)",
      "title": "Agents"
    },
    "hooks": {
      "anyOf": [
        {
          "items": {
            "$ref": "#/$defs/Hook"
          },
          "type": "array"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "Hook configurations (top-level in v3.0+)",
      "title": "Hooks"
    },
    "ignore_editor_files": {
      "anyOf": [
        {
          "type": "boolean"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "Automatically add editor-specific files to .gitignore (default: True)",
      "title": "Ignore Editor Files"
    }
  },
  "required": [
    "schema_version",
    "metadata",
    "content"
  ],
  "title": "Universal Prompt Format v3.1",
  "type": "object",
  "$schema": "http://json-schema.org/draft-07/schema#"
}
